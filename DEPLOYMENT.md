# Excalidraw CentOS 7 éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
./deploy.sh
```

### æŒ‡å®šæœåŠ¡å™¨IPéƒ¨ç½²
```bash
./deploy.sh 192.168.1.100
```

## ğŸ“‹ è„šæœ¬è¯´æ˜

### 1. deploy.sh - æœ¬æœºæ„å»ºä¼ è¾“è„šæœ¬
**åŠŸèƒ½:**
- è‡ªåŠ¨æ„å»ºDockeré•œåƒ
- å¯¼å‡ºé•œåƒä¸ºtaræ–‡ä»¶
- ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨
- åœ¨æœåŠ¡å™¨ä¸Šè‡ªåŠ¨éƒ¨ç½²
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶

**ä½¿ç”¨æ–¹æ³•:**
```bash
./deploy.sh                    # éƒ¨ç½²åˆ°é»˜è®¤æœåŠ¡å™¨(120.77.56.227)
./deploy.sh 192.168.1.100      # éƒ¨ç½²åˆ°æŒ‡å®šæœåŠ¡å™¨
```

### 2. server-deploy.sh - æœåŠ¡å™¨ç«¯ç‹¬ç«‹è„šæœ¬
**åŠŸèƒ½:**
- åœæ­¢æ—§å®¹å™¨
- å¯¼å…¥æ–°é•œåƒ
- å¯åŠ¨æ–°å®¹å™¨
- çŠ¶æ€æ£€æŸ¥å’Œç®¡ç†

**ä½¿ç”¨æ–¹æ³•:**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
./server-deploy.sh              # å®Œæ•´éƒ¨ç½²æµç¨‹
./server-deploy.sh status       # æŸ¥çœ‹çŠ¶æ€
./server-deploy.sh logs         # æŸ¥çœ‹æ—¥å¿—
./server-deploy.sh restart      # é‡å¯å®¹å™¨
./server-deploy.sh stop         # åœæ­¢å®¹å™¨
./server-deploy.sh start        # å¯åŠ¨å®¹å™¨
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### æœ¬æœºè¦æ±‚
- Dockerå·²å®‰è£…å¹¶å¯åŠ¨
- SSHå¯†é’¥: `~/tools/pem/ecs_label_studio_1.pem`
- ç½‘ç»œèƒ½è®¿é—®ç›®æ ‡æœåŠ¡å™¨

### æœåŠ¡å™¨è¦æ±‚(CentOS 7)
- Dockerå·²å®‰è£…: `yum install -y docker-ce`
- Dockerå·²å¯åŠ¨: `systemctl start docker`
- ç«¯å£9999å¯ç”¨(å¯åœ¨è„šæœ¬ä¸­ä¿®æ”¹)

## ğŸ“ é¡¹ç›®ç»“æ„
```
excalidraw/
â”œâ”€â”€ deploy.sh              # æœ¬æœºéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ server-deploy.sh       # æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬  
â”œâ”€â”€ Dockerfile             # Dockeræ„å»ºæ–‡ä»¶
â”œâ”€â”€ excalidraw-app/        # åº”ç”¨æºç 
â””â”€â”€ packages/              # æ ¸å¿ƒåŒ…
```

## ğŸŒ è®¿é—®æ–¹å¼

éƒ¨ç½²æˆåŠŸåå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®:
- **å¤–ç½‘**: `http://æœåŠ¡å™¨IP:9999`
- **å†…ç½‘**: `http://å†…ç½‘IP:9999`

## ğŸ›  æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. Dockeré•œåƒæ„å»ºå¤±è´¥**
```bash
# æ£€æŸ¥DockeræœåŠ¡
docker info
# æ¸…ç†æ„å»ºç¼“å­˜
docker system prune -f
```

**2. SSHè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥å¯†é’¥æƒé™
chmod 600 ~/tools/pem/ecs_label_studio_1.pem
# æµ‹è¯•è¿æ¥
ssh -i ~/tools/pem/ecs_label_studio_1.pem root@120.77.56.227
```

**3. ç«¯å£å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tuln | grep 9999
# ä¿®æ”¹è„šæœ¬ä¸­çš„PORTå˜é‡
```

**4. å®¹å™¨å¯åŠ¨å¤±è´¥**
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs excalidraw-app
# æ£€æŸ¥é•œåƒ
docker images | grep excalidraw
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æœ¬æœºæŸ¥çœ‹æ„å»ºæ—¥å¿—
docker build -t excalidraw-custom . 2>&1 | tee build.log

# æœåŠ¡å™¨æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f excalidraw-app

# æœåŠ¡å™¨æŸ¥çœ‹éƒ¨ç½²è„šæœ¬æ—¥å¿—
./server-deploy.sh logs
```

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ—¥å¸¸æ›´æ–°æµç¨‹
1. ä¿®æ”¹ä»£ç 
2. æäº¤åˆ°qiangåˆ†æ”¯
3. è¿è¡Œ `./deploy.sh`

### å›æ»šæ“ä½œ
```bash
# å¦‚éœ€å›æ»šï¼Œé‡æ–°æ„å»ºä¹‹å‰çš„ä»£ç 
git checkout ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„commit
./deploy.sh
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### å®¹å™¨çŠ¶æ€æ£€æŸ¥
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
./server-deploy.sh status
docker ps
docker stats excalidraw-app
```

### èµ„æºç›‘æ§
```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top
free -h
df -h
```

### è‡ªåŠ¨é‡å¯ç­–ç•¥
å®¹å™¨å·²é…ç½® `--restart unless-stopped`ï¼Œç³»ç»Ÿé‡å¯åä¼šè‡ªåŠ¨å¯åŠ¨ã€‚

## ğŸ” å®‰å…¨å»ºè®®

1. **SSHå¯†é’¥å®‰å…¨**
   - å®šæœŸæ›´æ¢SSHå¯†é’¥
   - ç¡®ä¿å¯†é’¥æ–‡ä»¶æƒé™ä¸º600

2. **é˜²ç«å¢™é…ç½®**
   ```bash
   # CentOS 7é˜²ç«å¢™è®¾ç½®
   firewall-cmd --permanent --add-port=9999/tcp
   firewall-cmd --reload
   ```

3. **å®šæœŸæ›´æ–°**
   - å®šæœŸæ›´æ–°Dockeré•œåƒ
   - æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜:
1. æŸ¥çœ‹è„šæœ¬è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥Dockerå’ŒSSHæœåŠ¡çŠ¶æ€
3. æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `docker logs excalidraw-app`
4. ä½¿ç”¨ `./server-deploy.sh status` æ£€æŸ¥éƒ¨ç½²çŠ¶æ€